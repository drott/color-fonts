[![CI Build Status](https://github.com/googlefonts/color-fonts/workflows/Continuous%20Test%20+%20Deploy/badge.svg)](https://github.com/googlefonts/color-fonts/actions/workflows/ci.yml?query=workflow%3ATest)

# color-fonts
Experimental color font builds. Intended to help verify font toolchain builds things that work with consuming tools for COLRv1 ([colr gradients spec](https://github.com/googlefonts/colr-gradients-spec/blob/main/colr-gradients-spec.md)).

To update the fonts:

1.  Run [generate_config.py](https://github.com/googlefonts/color-fonts/blob/main/generate_config.py) if the config needs to be updated
1.  Run [build.py](https://github.com/googlefonts/color-fonts/blob/main/build.py) to generate the font(s) you want to update

## Color fonts in the fonts/ folder

The [fonts/](fonts/) folder contains generated COLRv1 (with different glyph shape formats) and OT-SVG fonts for testing and experimentation. The files in this folder follow the following naming convention. 

```
(Glyph set)-(color font format and glyph definition format).(Extension otf or ttf)
```

The following glyph sets exist:

| Glyph set short name | Description |
|---|---|
| `noto` | Full Noto emoji set |
| `noto_handwriting` | Only the WRITING HAND ✍️ emoji  of the Noto Emoji set |
| `noto_flags` | Only the flag emoji of the Noto emoji set |
| `noto_noflags` | All but the flags of the Noto emoji set |
| `samples` | A set of sample glyphs generated from SVG sources |
| `twemoji` | The set of emoji from the [Twitter emoji](https://github.com/twitter/twemoji/) set |
| `tweomji_smiley` | Only the smiley emoji from the the [Twitter emoji](https://github.com/twitter/twemoji/) set |
| `more_samples` | A set of test glyphs generated by the a build script in [config/more_samples-glyf_colr_1.py](config/more_samples-glyf_colr_1.py) |

The following color font and glyph definition formats exist:

| Format short name | Description |
| -- | -- |
| `cff2_colr_1` | COLRv1 font with `CFF2` table contour definitions |
| `cff_colr_1` | COLRv1 fotn with `CFF ` table contour definitions |
| `glyf_colr_1` | COLRv1 fotn with `glyf ` table contour definitions (TrueType contours) |
| `picosvg` | OT-SVG font with SVG sources processed through picosvg |
| `picosvgz` | OT-SVG font with SVG sources processed through picosvg and gzip compressed |
| `untouchedsvg` | OT-SVG font with SVG source images embeddded as-is |
| `untouchedsvgz` | OT-SVG font with SVG source images embeddded as-is and gzip compressed |

For example, `noto-glyf_colr_1.ttf` means that this font contains the Noto Emoji
full glyph set, contains the glyph definitions in `glyf` table format (TrueType
outlines) and features a COLRv1 table for the color glyphs
functionality. `noto_flags-picosvgz.ttf` contains only the flag glyphs part of
the Noto emoji set, the font is an OT-SVG font where SVG source images went
through picosvg for optimization and flattening.

## Early preview of Variable COLRv1 examples

This branch
[`variableCOLRv1Preview`](https://github.com/googlefonts/color-fonts/tree/variableCOLRv1Preview)
contains very experimental and so far unreviewed examples of variable aspects of
COLRv1 for PaintVarRotate, variable color stops with PaintVarLinearGradient and
PaintVarRadialGradient as well as end angle variation for
PaintVarSweepGradient. I am sharing this with the intention of sharing early
access to variable COLRv1 for aiding development of COLRv1 implementations.

| Glyph id | Codepoint | Description                                                                                                                                 |
|----------|-----------|---------------------------------------------------------------------------------------------------------------------------------------------|
| 21-24    | t-w       | PaintVarRotate example, varying total angle deltas depending on glyph, maximum of 359.989013671875, ROTA axis, the orange cross is rotating |
| 15-20    | n-s       | Variable color stops, COL1-COLR axes, color stops can be varied -2 to 2, truncation and overflow may need to be discussed                   |
| 58-80    | α-ρ       | PaintVarSweepGradient, end angle, SWEP axis                                                                                                 |


### Building the variable COLRv1 font

A binary of the variable COLRv1 example font is available in the
`fonts/more_samples-glyf_colr_1.ttf` file in this branch. If you want to build
the font yourself, follow these steps:

1. In the checkout of this color-fonts repository, make a virtual environment using python venv.
2. Clone https://github.com/fonttools/fonttools/ to a separate directory
3. Check out branch `wip-variable-colr` in the checkout in 2
4. Run `$ pip install -e .` in the fonttools directory from 2, while staying in the virtual environment created in 1.
5. Change back to the color-fonts directory and run `$ ./build.py config/more_samples-glyf_colr_1.py`

To check whether a variable COLRv1 font was built, run
`$ ttx -tCOLR -o- fonts/more_samples-glyf_colr_1.ttf | grep VarStore`
which should show a `<VarStore Format="1">` line.

### Limitations

Currently, the variable COLRv1 font will always use a DeltaSetIndex map and not
use direct outer or inner indices into the VarStore.  The VarStore is not fully
space-optimized at this point.

## References

*   [nanoemoji](https://github.com/googlefonts/nanoemoji), compiles a set of picosvg into a color font 
*   [picosvg](https://github.com/googlefonts/picosvg), simplifies svgs to use only a small subset of the full spec
